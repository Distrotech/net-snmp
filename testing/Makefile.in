#
# Makefile for testing
#

TARG		= stest ktest etest

SUBDIRS		= 

USELIBS		= ../snmplib/libsnmp.$(SHLIB_EXTENSION)$(SHLIB_VERSION)
LIBS		= -L../snmplib $(CC_RUNTIME_ARG) -lsnmp @LIBS@

PARSEOBJS	=

CPPFLAGS	= -I.. -I$(srcdir)/.. -I$(srcdir)/../snmplib @CPPFLAGS@
CC		= @CC@ $(CPPFLAGS)


all: $(TARG) subdirs


subdirs:
	for i in $(SUBDIRS) ; do 	\
        	( cd $$i ; $(MAKE) ) ;	\
	done


#
# FIX	Ick, get rid of the direct reference to libsnmp.a...
#
etest:    etimetest.o $(PARSEOBJS) $(USELIBS)
	${CC} -o $@ etimetest.o ../snmplib/libsnmp.a $(PARSEOBJS) ${LDFLAGS} ${LIBS} 

ktest:    keymanagetest.o $(PARSEOBJS) $(USELIBS)
	${CC} -o $@ keymanagetest.o ../snmplib/libsnmp.a $(PARSEOBJS) ${LDFLAGS} ${LIBS} 

stest:    scapitest.o $(PARSEOBJS) $(USELIBS)
	${CC} -o $@ scapitest.o ../snmplib/libsnmp.a $(PARSEOBJS) ${LDFLAGS} ${LIBS} 


clean:
	rm -f *.o core *.core $(TARG) 
	for i in $(SUBDIRS) ; do		\
		( cd $$i ; $(MAKE) clean ) ;	\
	done


install: installdirs subdirs $(TARG)
	for i in $(SUBDIRS) ; do		\
        	( cd $$i ; $(MAKE) install ) ;	\
	done
	@for i in $(TARG) ; do $(INSTALL) $$i $(bindir) ; echo "install:  installed $$i in $(bindir)" ; done
	@for i in ; do $(INSTALL) $$i $(sbindir) ; echo "install:  installed $$i in $(sbindir)" ; done


installdirs:
	@$(SHELL) $(srcdir)/../mkinstalldirs $(snmplibdir) $(bindir)


dependlocal: 
	makedepend $(CPPFLAGS) $(srcdir)/*.c

depend: dependlocal
	for i in $(SUBDIRS) ; do		\
        	( cd $$i ; $(MAKE) depend ) ;	\
	done

nosysdepend: 
	for i in $(SUBDIRS) ; do			\
        	( cd $$i ; $(MAKE) nosysdepend ) ;	\
	done
	makedepend $(CPPFLAGS) *.c
	perl -n -i.bak -e ' if (/^# DO NOT DELETE THIS LINE/) {$$doit=1;} if ($$doit == 1) {s#/usr/(include|lib)/[^\s]+##g ; print if (! /^[\w]+\.o:\s*$$/);} else {print;}' Makefile

makefileindepend: nosysdepend
	cd snmpnetstat; $(MAKE) makefileindepend; cd ..
	perl -e ' rename("Makefile.in","Makefile.in.bak"); open(F,"Makefile.in.bak"); open(G,"Makefile"); open(O,">Makefile.in"); $$_ = <F>; while(!/^# DO NOT DELETE THIS LINE/) { print O $$_; $$_ = <F>; } print O $$_; $$_ = <G>; while(!/^# DO NOT DELETE THIS LINE/) { $$_ = <G>; } while (<G>) {print O $$_;} '


# DO NOT DELETE THIS LINE -- make depend depends on it.


scapitest.o:	
keymanagetest.o:

